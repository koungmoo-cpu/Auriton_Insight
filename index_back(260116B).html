<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auriton AI ìš´ëª… ì§„ë‹¨</title>
    <link rel="stylesheet" href="style.css">
    <script>
    window.CLAUDE_API_KEY = 'your-claude-api-key-here';
</script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Auriton AI ìš´ëª… ì§„ë‹¨</h1>
            <p class="subtitle">ë‹¹ì‹ ì˜ ìš´ëª…ì„ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤</p>
        </div>
        
        <form id="sajuForm" class="form-container">
            <div class="form-group">
                <label for="userName">ì„±í•¨ <span class="required">*</span></label>
                <input 
                    type="text" 
                    id="userName" 
                    name="userName"
                    placeholder="ì˜ˆ: í™ê¸¸ë™ ë˜ëŠ” John Smith"
                    maxlength="100"
                    required
                >
                <span class="error-message" id="userNameError"></span>
            </div>

            <div class="form-group">
                <label for="location">íƒœì–´ë‚œ ì§€ì—­ <span class="required">*</span></label>
                <input 
                    type="text" 
                    id="location" 
                    name="location"
                    placeholder="ì˜ˆ: ì„œìš¸, ë¶€ì‚°, ê²½ê¸°ë„ ìˆ˜ì›ì‹œ"
                    required
                >
                <span class="error-message" id="locationError"></span>
            </div>

            <div class="form-group gender-group">
                <label>ì„±ë³„ <span class="required">*</span></label>
                <div class="gender-toggle">
                    <label class="gender-check">
                        <input type="checkbox" id="genderMale" onclick="selectGenderCheckbox('male')">
                        <span>ë‚¨ì„±</span>
                    </label>
                    <label class="gender-check">
                        <input type="checkbox" id="genderFemale" onclick="selectGenderCheckbox('female')">
                        <span>ì—¬ì„±</span>
                    </label>
                </div>
                <input type="hidden" id="gender" name="gender">
                <span class="error-message" id="genderError"></span>
            </div>

            <div class="form-group">
                <label for="birthDateInput">ìƒë…„ì›”ì¼ <span class="required">*</span></label>
                <input 
                    type="text" 
                    id="birthDateInput" 
                    name="birthDateInput"
                    placeholder="ì˜ˆ: 19900101"
                    inputmode="numeric"
                    maxlength="8"
                    required
                >
                <span class="error-message" id="birthDateError"></span>
            </div>
            
            <div class="form-group">
                <label for="birthTime">íƒœì–´ë‚œ ì‹œê°„ <span class="required">*</span></label>
                <div class="time-select-container">
                    <select id="birthTime" name="birthTime" required>
                        <option value="" disabled selected>ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="unknown">ì‹œê°„ ëª¨ë¦„</option>
                        <option value="00:00">ì¡°ì/æœå­ (00:00~01:29)</option>
                        <option value="01:30">ì¶•/ä¸‘ (01:30~03:29)</option>
                        <option value="03:30">ì¸/å¯… (03:30~05:29)</option>
                        <option value="05:30">ë¬˜/å¯ (05:30~07:29)</option>
                        <option value="07:30">ì§„/è¾° (07:30~09:29)</option>
                        <option value="09:30">ì‚¬/å·³ (09:30~11:29)</option>
                        <option value="11:30">ì˜¤/åˆ (11:30~13:29)</option>
                        <option value="13:30">ë¯¸/æœª (13:30~15:29)</option>
                        <option value="15:30">ì‹ /ç”³ (15:30~17:29)</option>
                        <option value="17:30">ìœ /é…‰ (17:30~19:29)</option>
                        <option value="19:30">ìˆ /æˆŒ (19:30~21:29)</option>
                        <option value="21:30">í•´/äº¥ (21:30~23:29)</option>
                        <option value="23:30">ì•¼ì/å¤œå­ (23:30~23:59)</option>
                    </select>
                </div>
                <span class="error-message" id="birthTimeError"></span>
            </div>
            
            <div class="form-group">
                <label for="calendarType">ë‹¬ë ¥ ì„ íƒ <span class="required">*</span></label>
                <select id="calendarType" name="calendarType" required>
                    <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    <option value="solar">ì–‘ë ¥</option>
                    <option value="lunar">ìŒë ¥(í‰ë‹¬)</option>
                    <option value="lunar_leap">ìŒë ¥(ìœ¤ë‹¬)</option>
                </select>
                <span class="error-message" id="calendarTypeError"></span>
            </div>
            
            <button 
                type="submit" 
                id="analyzeBtn" 
                class="analyze-button" 
                disabled
            >
                ë¶„ì„ ì‹œì‘
            </button>
        </form>

        <div id="resultArea" class="result-area" style="display: none;">
            <h3>ë¶„ì„ ê²°ê³¼ (Raw Data)</h3>
            <p id="sajuData"></p>
            <p id="astrologyData"></p>
            <hr>
            <h3>AI ìƒë‹´ì‚¬ ì¸í„°í”„ë¦¬íŒ…</h3>
            <div id="chatContainer" class="chat-container">
                <div id="chatMessages" class="chat-messages"></div>
                <div class="chat-input-container">
                    <input 
                        type="text" 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..."
                        maxlength="500"
                    >
                    <button 
                        type="button" 
                        id="sendButton" 
                        class="send-button"
                        onclick="sendUserMessage()"
                    >
                        ì „ì†¡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-chat-section" class="mt-6 border-t pt-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">
        AI ìƒë‹´ì‚¬ì—ê²Œ ì¶”ê°€ ì§ˆë¬¸í•˜ê¸° (200ì ì œí•œ)
    </label>
    
    <div class="relative">
        <textarea 
            id="userQuestion" 
            rows="3" 
            maxlength="200"
            class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none resize-none"
            placeholder="ì˜ˆ: 1979ë…„ìƒ ë™ë£Œì™€ í•¨ê»˜ ì¼í•˜ë©´ ì–´ë–¨ê¹Œìš”?"
        ></textarea>
        
        <div class="absolute bottom-2 right-3 text-xs text-gray-400">
            <span id="charCount">0</span>/200
        </div>
    </div>

    <button 
        id="sendQuestionBtn" 
        class="w-full mt-3 bg-blue-900 text-white py-3 rounded-xl font-bold hover:bg-blue-800 transition"
    >
        ì§ˆë¬¸ ì „ì†¡í•˜ê¸°
    </button>
</div>
    
    <!-- lunar-javascript ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìŒë ¥ ê³„ì‚°ìš©) -->
    <script src="https://cdn.jsdelivr.net/gh/6tail/lunar-javascript@latest/lunar.min.js"></script>
    <!-- ëŒ€ì²´: GitHub Gist ë²„ì „ -->
    <script>
        // lunar-javascriptê°€ ë¡œë“œë˜ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ fallback
        if (typeof Lunar === 'undefined') {
            console.warn('lunar-javascriptê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ëŒ€ì²´ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
        }
    </script>
    <script src="script.js"></script>
    // 200ì ì¹´ìš´í„° ë° ì…ë ¥ ì œì–´ ë¡œì§
const questionInput = document.getElementById('userQuestion');
const charCountDisplay = document.getElementById('charCount');

questionInput.addEventListener('input', function() {
    const length = this.value.length;
    charCountDisplay.innerText = length;

    // ì‹œê°ì  í”¼ë“œë°± (180ì ë„˜ìœ¼ë©´ ê°•ì¡°)
    if (length >= 180) {
        charCountDisplay.classList.add('text-red-500', 'font-bold');
    } else {
        charCountDisplay.classList.remove('text-red-500', 'font-bold');
    }
});

// âœ… ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
document.getElementById('sendQuestionBtn').addEventListener('click', async () => {
    const questionInput = document.getElementById('userQuestion');
    const message = questionInput.value.trim();
    
    if (!message) return alert("ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    
    // ğŸ’¡ 11ë²ˆ ì¤„ ì£¼ì„ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤!
    sendChatMessage(message); 
});

// âœ… ì±„íŒ… ì „ì†¡ í•¨ìˆ˜
async function sendChatMessage(userMessage) {
    try {
        const chatSection = document.getElementById('ai-chat-section');
        const originalContent = chatSection.innerHTML;
        
        // 1. ë¡œë”© ìƒíƒœ í‘œì‹œ
        chatSection.innerHTML = "<p class='text-blue-600 animate-pulse'>ì „ë¬¸ ìƒë‹´ì‚¬ê°€ Simonë‹˜ì˜ ì§ˆë¬¸ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>";

        // 2. API í˜¸ì¶œ
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                userMessage: userMessage,
                rawData: window.globalRawData // ë¶„ì„ ì‹œ ì €ì¥í•´ë‘” ì „ì—­ ë³€ìˆ˜
            })
        });

        const result = await response.json();

        if (result.success) {
            // 3. ğŸ‰ ë‹µë³€ í™”ë©´ ì¶œë ¥
            chatSection.innerHTML = originalContent; // ë¡œë”© ë©”ì‹œì§€ ì œê±°
            const answerBox = document.createElement('div');
            // Simonë‹˜ì´ ì‚¬ì§„ì— ë„£ìœ¼ì‹  ì„¸ë ¨ëœ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œì…ë‹ˆë‹¤.
            answerBox.className = "mt-4 p-4 bg-blue-50 rounded-xl border-l-4 border-blue-500 shadow-sm";
            answerBox.innerHTML = `
                <p class="font-bold text-gray-800 mb-2">Q: ${userMessage}</p>
                <p class="text-gray-700 leading-relaxed"><strong>A:</strong> ${result.answer}</p>
            `;
            chatSection.appendChild(answerBox);
            
            // 4. ì…ë ¥ì°½ ë° ì¹´ìš´í„° ì´ˆê¸°í™”
            document.getElementById('userQuestion').value = '';
            document.getElementById('charCount').innerText = '0';
        }
    } catch (error) {
        console.error("í†µì‹  ì˜¤ë¥˜:", error);
        alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }
}
</body>
</html>
